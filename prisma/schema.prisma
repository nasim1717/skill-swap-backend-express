generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

enum RequestStatus {
  PENDING
  ACCEPTED
  DECLINED
}

model users {
  id              Int       @id @default(autoincrement())
  name            String?
  email           String    @unique
  password        String
  profile_picture String?
  bio             String?   @db.Text
  location        String?
  created_at      DateTime  @default(now())
  updated_at      DateTime? @updatedAt

  skills_offered    skills_offered[]
  skills_wanted     skills_wanted[]
  sent_messages     messages[]       @relation("sent_messages")
  received_messages messages[]       @relation("received_messages")
  reviews_written   reviews[]        @relation("reviews_written")
  reviews_received  reviews[]        @relation("reviews_received")

  sent_requests     chat_requests[] @relation("request_sender")
  received_requests chat_requests[] @relation("request_receiver")
  threads_as_a      chat_threads[]  @relation("participantA")
  threads_as_b      chat_threads[]  @relation("participantB")

  @@map("users")
}

model skills_offered {
  id         Int       @id @default(autoincrement())
  user_id    Int       @unique
  skills     String
  created_at DateTime  @default(now())
  updated_at DateTime? @updatedAt

  user users @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("skills_offered")
}

model skills_wanted {
  id         Int       @id @default(autoincrement())
  user_id    Int       @unique
  skills     String
  created_at DateTime  @default(now())
  updated_at DateTime? @updatedAt

  user users @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@index([user_id])
  @@map("skills_wanted")
}

model messages {
  id          Int       @id @default(autoincrement())
  sender_id   Int
  receiver_id Int
  message     String    @db.Text
  thread_id   Int?
  seen        Boolean   @default(false)
  created_at  DateTime  @default(now())
  updated_at  DateTime? @updatedAt

  sender   users         @relation("sent_messages", fields: [sender_id], references: [id], onDelete: Cascade)
  receiver users         @relation("received_messages", fields: [receiver_id], references: [id], onDelete: Cascade)
  thread   chat_threads? @relation(fields: [thread_id], references: [id], onDelete: Cascade)

  @@index([sender_id])
  @@index([receiver_id])
  @@index([thread_id])
  @@map("messages")
}

model chat_requests {
  id          Int           @id @default(autoincrement())
  sender_id   Int
  receiver_id Int
  status      RequestStatus @default(PENDING)
  message     String?       @db.Text
  created_at  DateTime      @default(now())
  updated_at  DateTime?     @updatedAt

  sender   users @relation("request_sender", fields: [sender_id], references: [id], onDelete: Cascade)
  receiver users @relation("request_receiver", fields: [receiver_id], references: [id], onDelete: Cascade)

  @@index([sender_id])
  @@index([receiver_id])
  @@map("chat_requests")
}

model chat_threads {
  id            Int      @id @default(autoincrement())
  participant_a Int
  participant_b Int
  created_at    DateTime @default(now())

  participantA users @relation("participantA", fields: [participant_a], references: [id], onDelete: Cascade)
  participantB users @relation("participantB", fields: [participant_b], references: [id], onDelete: Cascade)

  messages messages[]

  @@unique([participant_a, participant_b])
  @@map("chat_threads")
}

model reviews {
  id               Int       @id @default(autoincrement())
  reviewer_id      Int
  reviewed_user_id Int
  rating           Int       @db.TinyInt
  comment          String?   @db.Text
  created_at       DateTime  @default(now())
  updated_at       DateTime? @updatedAt

  reviewer users @relation("reviews_written", fields: [reviewer_id], references: [id], onDelete: Cascade)
  reviewed users @relation("reviews_received", fields: [reviewed_user_id], references: [id], onDelete: Cascade)

  @@index([reviewer_id])
  @@index([reviewed_user_id])
  @@map("reviews")
}
